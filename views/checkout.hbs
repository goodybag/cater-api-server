<div class="page page-checkout container">
  <div class="row">
    {{> wizard }}
  </div>

  {{#if order.editable}}
  <div class="row">
    <div class="alerts col-lg-12">
      <div class="alert alert-danger alert-bad-zip row{{#unless order.restaurant.is_bad_zip}} hide{{/unless}}" data-error="is_bad_zip">
        <div class="col-sm-8 alert-left">
          <h3 class="alert-header">Invalid Delivery Zip :(</h3>
          <p>This order can only be delivered to the zip codes listed</p>
        </div>
        <div class="col-sm-4 alert-right">
          <ul class="list-delivery-zips">
          {{#each order.restaurant.delivery_zips}}
            <li class="delivery-zip">{{this}}</li>
          {{/each}}
          </ul>
        </div>
      </div>

      <div class="alert alert-danger alert-bad-delivery-time row{{#unless order.restaurant.is_bad_delivery_time}} hide{{/unless}}" data-error="is_bad_delivery_time">
        <div class="col-sm-8 alert-left">
          <h3 class="alert-header">Invalid Delivery Time :(</h3>
          <p>This order cannot be delivered for that date and time. Please ensure that your delivery time is within the restaurants schedule.</p>
        </div>
        <div class="col-sm-4 alert-right">
          {{> delivery_times order.restaurant }}
        </div>
      </div>

      <div class="alert alert-danger alert-bad-guests{{#unless order.restaurant.is_bad_guests}} hide{{/unless}}" data-error="is_bad_guests">
        <p>This order cannot be delivered for that many guests.</p>
        <p><strong>Maximum guests:</strong> {{order.restaurant.max_guests}}</p>
      </div>

      <div class="alert alert-danger alert-bad-lead-time row{{#unless order.restaurant.is_bad_lead_time}} hide{{/unless}}" data-error="is_bad_lead_time">
        <div class="col-sm-8 alert-left">
          <h3 class="alert-header">Invalid Delivery Time :(</h3>
          <p>This order cannot be delivered for that many guests without more lead time. Please check lead times for this restaurant.</p>
        </div>
        <div class="col-sm-4 alert-right">
          {{> lead_times order.restaurant }}
        </div>
      </div>
    </div>
  </div>
  {{/if}}

  <div class="row">
    <div class="col-md-8">
      <div class="panel">
        <form id="order-form">
          <div class="panel-body">
            <fieldset>
              <legend>1. Order Details</legend>
              <div class="row">
                <h5 class="col-md-12">{{order.restaurant.name}}</h5>
              </div>
              <div class="row form-inline">
                <div class="col-sm-7">
                  <div class="form-group col-sm-4 form-group-delivery-date" data-icon="gb-icon-calendar">
                    <label class="control-label" for="order-date">Delivery Date</label>
                    <input type="text" class="form-control order-datetime" id="order-date" value="{{#if order.datetime}}{{formatDateTime order.datetime}}{{else}}{{formatDateTime orderParams.date}}{{/if}}"{{#unless order.editable}} disabled="disabled"{{/unless}}>
                  </div>
                  <div class="form-group col-sm-4 form-group-delivery-time" data-icon="gb-icon-time">
                    <label class="control-label" for="order-time">Delivery Time</label>
                    <input type="text" class="form-control order-datetime" id="order-time" value="{{#if order.datetime}}{{formatDateTime order.datetime 'hh:mm A'}}{{else}}{{formatTime orderParams.time}}{{/if}}"{{#unless order.editable}} disabled="disabled"{{/unless}}>
                  </div>
                  <div class="form-group col-sm-4" data-icon="gb-icon-user">
                    <label class="control-label" for="order-guests">Guests</label>
                    <input type="number" class="form-control" id="order-guests" value="{{#if order.guests}}{{order.guests}}{{else}}{{orderParams.guests}}{{/if}}"{{#unless order.editable}} disabled="disabled"{{/unless}}>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-sm-6">
                  <label class="control-label">Order Name</label>
                  <input type="text" class="form-control order-name" value="{{order.name}}" placeholder="e.g. Tuesday Meeting">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-sm-8">
                  <label class="control-label" for="order-notes">Special instructions for this order?</label>
                  <textarea id="order-notes" class="form-control order-notes" rows="3"{{#unless order.editable}} disabled="disabled"{{/unless}}>{{order.notes}}</textarea>
                </div>
              </div>
              <div class="row tip-area">
                <div class="col-sm-12">
                  <div class="form-group">
                    <label class="control-label">Add tip</label>
                    <select class="form-control tip-percent">
                      {{! eq is ugly as hell but it works }}
                      <option value="0"{{#eq order.tip_percent "0"}} selected="selected"{{/eq}}>No Tip</option>
                      <option value="custom"{{#eq order.tip_percent "custom"}} selected="selected"{{/eq}}>Custom Tip</option>
                      <option value="5"{{#eq order.tip_percent "5"}} selected="selected"{{/eq}}>5%</option>
                      <option value="10"{{#eq order.tip_percent "10"}} selected="selected"{{/eq}}>10%</option>
                      <option value="15"{{#eq order.tip_percent "15"}} selected="selected"{{/eq}}>15%</option>
                      <option value="18"{{#eq order.tip_percent "18"}} selected="selected"{{/eq}}>18%</option>
                      <option value="20"{{#eq order.tip_percent "20"}} selected="selected"{{/eq}}>20%</option>
                      <option value="25"{{#eq order.tip_percent "25"}} selected="selected"{{/eq}}>25%</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <input type="nubmer" class="form-control order-tip" value="{{dollars order.tip}}">
                  </div>
                </div>
              </div>
            </fieldset>
            <fieldset class="row delivery-info">
                {{> order_delivery_info}}
            </fieldset>
            <fieldset id="payment-info" class="row">
              <div class="col-md-6">
                <legend>3. Payment Info</legend>

                <div class="radio">
                  <label>
                    <input type="radio" name="payment-method" class="payment-method" data-parent="#payment-info" checked="checked">
                  </label>
                  Pay using <select class="form-control">
                    <option>placeholder 1</option>
                    <option>placeholder 2</option>
                    <option>placeholder 3</option>
                  </select>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="payment-method" class="payment-method" data-target="#new-card" data-parent="#payment-info">
                    Use a new card.
                  </label>
                </div>

                <div id="new-card" class="collapse">
                  <div class="form-group">
                    <label class="control-label">Card Title</label>
                    <input type="text" class="form-control credit-card-title">
                  </div>
                  <div class="form-group">
                    <label class="control-label">Card Number</label>
                    <input type="text" class="form-control credit-card-title">
                  </div>
                  <div class="form-group">
                    <label class="control-label">Card Title</label>
                    <input type="text" class="form-control credit-card-title">
                  </div>
                  <div class="form-inline">
                    <div class="form-group">
                      <label class="control-label">Expiration Date</label>
                      <input type="month" class="form-control">
                    </div>
                  </div>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" checked="checked">
                      Save this card for future orders.
                    </label>
                  </div>
                </div>

                <div class="radio">
                  <label>
                    <input type="radio" name="payment-method" class="payment-method" data-parent="#payment-info">
                    Pay via invoice.
                  </label>
                </div>

              </div>
            </fieldset>
          </div>
          <div class="panel-footer">
            <fieldset>
              <div class="btn-toolbar pull-right">
                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#cancel-confirm-modal">Cancel Order</button>
                <button type="submit" class="btn btn-primary">Submit Order</button>
              </div>
            </fieldset>
          </div>
        </form>
      </div>
    </div>
    <div class="col-md-4">
     <div class="panel" data-spy="affix" data-offset-top="118">
       {{> checkout_order_summary}}
     </div>
    </div>
  </div>
</div>

<!-- Begin Modals -->

<div id="select-address-modal" class="modal fade">
  <div class="modal-dialog">
    <form id="select-address-form" class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Select a different address</h4>
      </div>
      <div class="modal-body">
        {{#each user.addresses}}
        <div class="radio">
          <label>
            <input type="radio" name="address-radio" data-id="{{id}}"{{#if this.is_default}} checked="checked"{{/if}}>
            {{> address}}
          </label>
        </div>
        {{else}}
        You have no saved addresses within this restaurant's delivery zone.
        {{/each}}
      </div>
      <div class="modal-footer btn-toolbar">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        {{#if user.addresses}}
        <button type="submit" class="btn btn-primary">Deliver to selected address</button>
        {{/if}}
      </div>
    </form>
  </div>
</div>

<div id="cancel-confirm-modal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Confirm Cancel</h4>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to cancel this order?</p>
      </div>
      <div class="row modal-footer">
        <div class="col-lg-3 col-lg-offset-6">
          <button type="button" class="btn btn-default" data-dismiss="modal">No, don't cancel</button>
        </div>
        <div class="col-lg-3">
          <button type="button" class="btn btn-danger btn-cancel">Yes, cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- End Modals -->

{{#extend "scripts"}}
<script>
  var partials = {
    order_delivery_info: 'order-delivery-info.hbs',
    address: 'address.hbs',
    edit_address: 'edit-address.hbs'
  };

  for (var name in partials) {
    $.ajax({
      type: 'GET',
      url: '/partials/' + partials[name],
      success: function(data, textStatus, jqXHR) {
        Handlebars.registerPartial(name, Handlebars.compile(data));
      },
      dataType: 'html',
      async: false
    });
  }
</script>

<script src="/js/models/address.js"></script>
<script src="/js/models/user.js"></script>
<script src="/js/models/item.js"></script>
<script src="/js/models/category.js"></script>
<script src="/js/models/restaurant.js"></script>d
<script src="/js/models/order-item.js"></script>
<script src="/js/models/order.js"></script>

<script src="/js/collections/addresses.js"></script>
<script src="/js/collections/items.js"></script>
<script src="/js/collections/categories.js"></script>

<script src="/js/views/form-view.js"></script>
<script src="/js/views/address-view.js"></script>
<script src="/js/views/order-address-view.js"></script>
<script src="/js/views/checkout-view.js"></script>

<script>
  var view = new CheckoutView({el: '#main', model: new Order( {{{json order}}} ), user: new User({{{json user}}})});
</script>
{{/extend}}
